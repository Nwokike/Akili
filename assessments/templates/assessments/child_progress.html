{% extends 'base.html' %}
{% block title %}{{ child.get_full_name }}'s Progress - Akili{% endblock %}
{% block page_title %}{{ child.get_full_name }}'s Progress{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-8 px-4">
  <div class="card mb-6">
    <div class="flex items-center">
      <div class="w-16 h-16 bg-primary-100 dark:bg-primary-900 rounded-full flex items-center justify-center mr-4">
        <span class="text-2xl text-primary-600 dark:text-primary-400 font-bold">
          {{ child.first_name|slice:":1" }}{{ child.last_name|slice:":1" }}
        </span>
      </div>
      <div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ child.get_full_name }}</h2>
        <p class="text-gray-600 dark:text-gray-400">{{ child.email }}</p>
      </div>
    </div>
  </div>

  <div class="grid md:grid-cols-2 gap-6">
    <div class="card">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Recent Grades</h3>
      <div class="space-y-3 max-h-96 overflow-y-auto">
        {% for grade in grades %}
        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
          <div>
            <p class="font-medium text-gray-900 dark:text-white">{{ grade.curriculum.subject.name }}</p>
            <p class="text-sm text-gray-500 dark:text-gray-400">{{ grade.term.name }}</p>
          </div>
          <div class="text-right">
            <span class="px-3 py-1 rounded font-bold
              {% if grade.grade_letter == 'A' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
              {% elif grade.grade_letter == 'B' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200
              {% elif grade.grade_letter == 'C' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200
              {% elif grade.grade_letter == 'D' %}bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200
              {% elif grade.grade_letter == 'E' %}bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200
              {% else %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200{% endif %}">
              {{ grade.grade_letter }}
            </span>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">{{ grade.total_score|floatformat:0 }}%</p>
          </div>
        </div>
        {% empty %}
        <p class="text-center text-gray-500 dark:text-gray-400 py-4">No grades available yet.</p>
        {% endfor %}
      </div>
    </div>

    <div class="card">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Progress Reports</h3>
      <div class="space-y-3 max-h-96 overflow-y-auto">
        {% for report in reports %}
        <div class="p-4 border border-gray-200 dark:border-gray-600 rounded-lg">
          <div class="flex justify-between items-start">
            <div>
              <h4 class="font-medium text-gray-900 dark:text-white">{{ report.term.name }}</h4>
              <p class="text-sm text-gray-500 dark:text-gray-400">{{ report.academic_session.name }}</p>
            </div>
            <div class="text-right">
              <p class="text-2xl font-bold text-primary-600 dark:text-primary-400">{{ report.average_score|floatformat:1 }}%</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">Average</p>
            </div>
          </div>
          <div class="mt-3 flex justify-between text-sm text-gray-600 dark:text-gray-400">
            <span>GPA: {{ report.average_grade_point|floatformat:2 }}</span>
            <span>{{ report.subjects_passed }}/{{ report.total_subjects }} subjects passed</span>
          </div>
          {% if report.position %}
          <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
            Position: #{{ report.position }} of {{ report.total_students }}
          </p>
          {% endif %}
        </div>
        {% empty %}
        <p class="text-center text-gray-500 dark:text-gray-400 py-4">No progress reports available.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="mt-6">
    <a href="{% url 'assessments:parent_dashboard' %}" class="btn-secondary">Back to Dashboard</a>
  </div>
</div>
{% endblock %}
