{% extends 'base.html' %}
{% block title %}{{ assessment.title }} - Akili{% endblock %}
{% block page_title %}{{ assessment.title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8 px-4">
  <div class="card mb-6">
    <div class="flex justify-between items-start mb-4">
      <div>
        <span class="px-3 py-1 bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full text-sm">
          {{ assessment.get_assessment_type_display }}
        </span>
        <p class="text-gray-600 dark:text-gray-400 mt-2">
          {{ assessment.curriculum.subject.name }} - {{ assessment.curriculum.school_level.name }}
        </p>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-500 dark:text-gray-400">Duration: {{ assessment.duration_minutes }} minutes</p>
        <p class="text-sm text-gray-500 dark:text-gray-400">Total Marks: {{ assessment.total_marks }}</p>
        <p class="text-sm text-gray-500 dark:text-gray-400">Passing: {{ assessment.passing_marks }} marks</p>
      </div>
    </div>
    {% if assessment.instructions %}
    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4 mb-4">
      <h4 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-2">Instructions</h4>
      <p class="text-yellow-700 dark:text-yellow-300">{{ assessment.instructions }}</p>
    </div>
    {% endif %}
  </div>

  {% if submission.status == 'GRADED' %}
  <div class="card bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 mb-6">
    <p class="text-green-700 dark:text-green-300 text-center">
      You have already completed this assessment. 
      <a href="{% url 'assessments:assessment_result' assessment.pk %}" class="underline font-semibold">View Results</a>
    </p>
  </div>
  {% else %}
  <form method="post" class="space-y-6">
    {% csrf_token %}
    {% for question in questions %}
    <div class="card">
      <div class="flex justify-between items-start mb-4">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
          Question {{ forloop.counter }}
        </h3>
        <span class="text-sm text-gray-500 dark:text-gray-400">{{ question.marks }} mark{{ question.marks|pluralize }}</span>
      </div>
      <p class="text-gray-700 dark:text-gray-300 mb-4">{{ question.question_text }}</p>
      
      {% if question.question_type == 'MCQ' %}
      <div class="space-y-2">
        {% for key, value in question.options.items %}
        <label class="flex items-center p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
          <input type="radio" name="question_{{ question.id }}" value="{{ key }}" class="mr-3 text-primary-600 focus:ring-primary-500">
          <span class="text-gray-700 dark:text-gray-300"><strong>{{ key }}.</strong> {{ value }}</span>
        </label>
        {% endfor %}
      </div>
      {% elif question.question_type == 'TRUE_FALSE' %}
      <div class="space-y-2">
        <label class="flex items-center p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
          <input type="radio" name="question_{{ question.id }}" value="True" class="mr-3 text-primary-600 focus:ring-primary-500">
          <span class="text-gray-700 dark:text-gray-300">True</span>
        </label>
        <label class="flex items-center p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
          <input type="radio" name="question_{{ question.id }}" value="False" class="mr-3 text-primary-600 focus:ring-primary-500">
          <span class="text-gray-700 dark:text-gray-300">False</span>
        </label>
      </div>
      {% else %}
      <textarea name="question_{{ question.id }}" rows="4" 
        class="w-full px-4 py-2 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
        placeholder="Enter your answer here..."></textarea>
      {% endif %}
    </div>
    {% empty %}
    <div class="card text-center py-8">
      <p class="text-gray-500 dark:text-gray-400">No questions available for this assessment.</p>
    </div>
    {% endfor %}

    {% if questions %}
    <div class="flex justify-between items-center">
      <a href="{% url 'assessments:assessments_list' %}" class="btn-secondary">Cancel</a>
      <button type="submit" class="btn-primary">Submit Assessment</button>
    </div>
    {% endif %}
  </form>
  {% endif %}
</div>
{% endblock %}
